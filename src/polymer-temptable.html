i<!-- Import Polymer -->
<link rel="import" href="../bower_components/polymer/polymer.html">

<!-- Define your custom element -->
<polymer-element name="polymer-temptable" attributes="orderBy">

    <template hidden?="{{!ready}}">
        <div hidden?="{{!ls}}">
            <input type="text" id="itemText" />
            <button on-click="{{add}}">Add item</button>
            <button on-click="{{reset}}">Reset items</button>
            <ul>
                <template repeat="{{item, i in list}}">
                    <li on-click="{{change}}" data-pos="{{i}}">{{item.label}} // {{item.done}}</li>
                </template>
            </ul>
        </div>
        <div hidden?="{{ls}}">Error. No localStorage!</div>
    </template>
    
    <script>
        Polymer('polymer-temptable', {
            list: [],
            ls: false,
            ready: function() {
                if (this.hasLocalStorage()) {
                    this.ls = true;
                    this.load();
                }
            },
            hasLocalStorage: function () {
                // Check localStorage testing set/remove test item
                var test = 'test';
                try {
                    localStorage.setItem(test, test);
                    localStorage.removeItem(test);
                    return true;
                } catch(e) {
                    return false;
                }
            },
            add: function () {
                if (this.$.itemText.value) {
                    // Create item
                    var item = {
                        label: this.$.itemText.value,
                        done: false
                    }

                    // Add item to the list
                    if (this.orderBy == 'asc') {
                        this.list.unshift(item);
                    } else {
                        this.list.push(item);
                    }

                    // Save list
                    this.save();

                    // Clean input
                    this.clean();
                }
            },
            clean: function () {
                this.$.itemText.value = '';
            },
            change: function (event, detail, sender) {
                // Negate selected item
                this.list[sender.dataset.pos].done =
                  !this.list[sender.dataset.pos].done;
                this.save();
            },
            load: function () {
                // Load list from localStorage
                if (localStorage.getItem("tempList") !== null) {
                    this.list = JSON.parse(localStorage.getItem("tempList"));
                }
            },
            save: function () {
                // Save list to localStorage
                localStorage.setItem("tempList", JSON.stringify(this.list));
            },
            reset: function () {
                // Reset list
                this.list = [];
                localStorage.setItem("tempList", JSON.stringify([]));
                this.clean();
            }
        });
    </script>

</polymer-element>
